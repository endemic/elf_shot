if(window.requestAnimationFrame===undefined){window.requestAnimationFrame=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame}if(window.cancelAnimationFrame===undefined){window.cancelAnimationFrame=window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame}var Vectr={VERSION:"0.1",Game:function(t,e,i,s){if(t===undefined){t=320}if(e===undefined){e=480}if(typeof i!=="function"){throw"Please provide a valid Scene object."}if(s===undefined){s=true}Vectr.WIDTH=t;Vectr.HEIGHT=e;Vectr.SCALE=1;Vectr.OFFSET={x:0,y:0};Vectr.instance=this;this.element=document.createElement("div");this.element.setAttribute("id","vectr");this.canvas=document.createElement("canvas");this.canvas.setAttribute("width",t);this.canvas.setAttribute("height",e);this.context=this.canvas.getContext("2d");this.element.appendChild(this.canvas);document.body.appendChild(this.element);this.onResize=this.onResize.bind(this);this.onPointStart=this.onPointStart.bind(this);this.onPointMove=this.onPointMove.bind(this);this.onPointEnd=this.onPointEnd.bind(this);this.onKeyDown=this.onKeyDown.bind(this);this.onKeyUp=this.onKeyUp.bind(this);this.pause=this.pause.bind(this);this.resume=this.resume.bind(this);document.addEventListener("keydown",this.onKeyDown,false);document.addEventListener("keyup",this.onKeyUp,false);this.element.addEventListener("mousedown",this.onPointStart,false);this.element.addEventListener("mouseup",this.onPointEnd,false);this.element.addEventListener("touchstart",this.onPointStart,false);this.element.addEventListener("touchmove",this.onPointMove,false);this.element.addEventListener("touchend",this.onPointEnd,false);document.addEventListener("touchmove",function(t){t.preventDefault()});if(s===true){this.onResize();window.addEventListener("resize",this.onResize,false)}if(window.cordova!==undefined){document.addEventListener("pause",this.pause,false);document.addEventListener("resume",this.resume,false)}this.input={left:false,up:false,right:false,down:false,w:false,a:false,s:false,d:false,enter:false,escape:false,space:false,control:false,z:false,x:false};this.points=[];this.active=new i;this.start()}};Vectr.Game.prototype.pause=function(){this.pausedMusic=this.currentMusic;Vectr.stopMusic();if(typeof this.active.pause==="function"){this.active.pause()}};Vectr.Game.prototype.resume=function(){Vectr.playMusic(this.pausedMusic);if(typeof this.active.resume==="function"){this.active.resume()}};Vectr.Game.prototype.onPointStart=function(t){Vectr.getPoints(t);if(t.type.indexOf("mouse")!==-1){this.element.addEventListener("mousemove",this.onPointMove,false)}if(typeof this.active.onPointStart==="function"){this.active.onPointStart(this.points)}};Vectr.Game.prototype.onPointMove=function(t){Vectr.getPoints(t);if(typeof this.active.onPointMove==="function"){this.active.onPointMove(this.points)}};Vectr.Game.prototype.onPointEnd=function(t){Vectr.getPoints(t);if(t.type.indexOf("mouse")!==-1){this.element.removeEventListener("mousemove",this.onPointMove,false)}if(typeof this.active.onPointEnd==="function"){this.active.onPointEnd(this.points)}};Vectr.Game.prototype.onKeyDown=function(t){var e;switch(t.keyCode){case 37:e="left";break;case 38:e="up";break;case 39:e="right";break;case 40:e="down";break;case 87:e="w";break;case 65:e="a";break;case 83:e="s";break;case 68:e="d";break;case 13:e="enter";break;case 27:e="escape";break;case 32:e="space";break;case 17:e="control";break;case 90:e="z";break;case 88:e="x";break;default:break}if(this.input[e]===true){return}this.input[e]=true;if(typeof this.active.onKeyDown==="function"){this.active.onKeyDown(e)}};Vectr.Game.prototype.onKeyUp=function(t){var e;switch(t.keyCode){case 37:e="left";break;case 38:e="up";break;case 39:e="right";break;case 40:e="down";break;case 87:e="w";break;case 65:e="a";break;case 83:e="s";break;case 68:e="d";break;case 13:e="enter";break;case 27:e="escape";break;case 32:e="space";break;case 17:e="control";break;case 90:e="z";break;case 88:e="x";break;default:break}this.input[e]=false;if(typeof this.active.onKeyUp==="function"){this.active.onKeyUp(e)}};Vectr.Game.prototype.start=function(){var t,e,i;e=this;if(typeof window.performance!==undefined){t=window.performance.now()}else{t=Date.now()}i=function(s){var n=s-t;t=s;e.update(n/1e3);e.updateId=window.requestAnimationFrame(i)};this.updateId=window.requestAnimationFrame(i)};Vectr.Game.prototype.stop=function(){window.cancelAnimationFrame(this.updateId)};Vectr.Game.prototype.update=function(t){this.active.draw(this.context);this.active.update(t)};Vectr.Game.prototype.onResize=function(t){var e,i,s,n,o;e=window.innerWidth;i=window.innerHeight;if(e>i){n="landscape";s=Vectr.WIDTH/Vectr.HEIGHT}else{n="portrait";s=Vectr.HEIGHT/Vectr.WIDTH}if(n==="landscape"){if(e/s>i){e=i*s;o="0 "+(window.innerWidth-e)/2+"px"}else if(e/s<i){i=e/s;o=(window.innerHeight-i)/2+"px 0"}}else if(n==="portrait"){if(i/s>e){i=e*s;o=(window.innerHeight-i)/2+"px 0"}else if(i/s<e){e=i/s;o="0 "+(window.innerWidth-e)/2+"px"}}Vectr.SCALE=i/Vectr.HEIGHT;Vectr.OFFSET.x=(window.innerWidth-e)/2;Vectr.OFFSET.y=(window.innerHeight-i)/2;this.element.setAttribute("style","position: relative; width: "+e+"px; height: "+i+"px; margin: "+o);this.canvas.setAttribute("style","position: absolute; left: 0; top: 0; -webkit-transform: scale("+Vectr.SCALE+"); -webkit-transform-origin: 0 0;")};Vectr.env=function(){var t,e,i,s,n;t=navigator.userAgent.toLowerCase();e=t.match(/android/i)&&t.match(/android/i).length>0||false;i=(t.match(/ip(hone|od|ad)/i)&&t.match(/ip(hone|od|ad)/i).length)>0||false;s=t.match(/firefox/i)&&t.match(/firefox/i).length>0||false;n=t.match(/mobile/i)&&t.match(/mobile/i).length>0||false||e;return{android:e,ios:i,firefox:s,mobile:n,desktop:!n,cordova:window.cordova!==undefined}}();Vectr.changeScene=function(t){if(typeof t!=="function"){throw"Trying to change to an invalid scene."}Vectr.instance.active.destroy();Vectr.instance.active=new t};Vectr.getPoints=function(t){var e=0,i;Vectr.instance.points.length=0;if(t.type.indexOf("mouse")!==-1){Vectr.instance.points.push({x:(t.pageX-Vectr.OFFSET.x)/Vectr.SCALE,y:(t.pageY-Vectr.OFFSET.y)/Vectr.SCALE})}else{i=t.touches.length;while(e<i){Vectr.instance.points.push({x:(t.touches[e].pageX-Vectr.OFFSET.x)/Vectr.SCALE,y:(t.touches[e].pageY-Vectr.OFFSET.y)/Vectr.SCALE});e+=1}}};Vectr.music={};Vectr.sounds={};Vectr.currentMusic=null;Vectr.playSfx=function(t){if(localStorage.getItem("playSfx")==="false"){return}if(typeof Vectr.sounds[t]!==undefined&&typeof Vectr.sounds[t].play==="function"){Vectr.sounds[t].play()}};Vectr.playMusic=function(t){if(localStorage.getItem("playMusic")==="false"){return}if(Vectr.currentMusic===t){return}if(typeof t===undefined&&Vectr.currentMusic!==null){t=Vectr.currentMusic}if(Vectr.currentMusic!==null){Vectr.music[Vectr.currentMusic].stop()}Vectr.music[t].play();Vectr.currentMusic=t};Vectr.stopMusic=function(){if(Vectr.currentMusic===null){return}Vectr.music[Vectr.currentMusic].stop();Vectr.currentMusic=null};Vectr.Button=function(t,e,i,s,n,o){this.label=new Vectr.Label(t,e,i,n,o,"center");this.position={x:n,y:o};this.backgroundColor=s;this.height=parseInt(e.split(" ").shift(),10);this.active=true;this.solid=true;this.padding=10;this.onPointEnd=this.onPointEnd.bind(this);Vectr.instance.element.addEventListener("mouseup",this.onPointEnd,false);Vectr.instance.element.addEventListener("touchend",this.onPointEnd,false)};Vectr.Button.prototype.draw=function(t){if(this.active===false){return}this.width=this.label.width(t);t.save();t.translate(this.position.x,this.position.y);if(this.solid===true){t.fillStyle=this.backgroundColor;t.fillRect(-this.width/2-this.padding/2,-this.height/2-this.padding,this.width+this.padding,this.height+this.padding)}else{t.strokeStyle=this.backgroundColor;t.strokeRect(-this.width/2-this.padding/2,-this.height/2-this.padding/2,this.width+this.padding,this.height+this.padding)}t.restore();this.label.draw(t)};Vectr.Button.prototype.onPointEnd=function(t){if(this.active===false||typeof this.onUp!=="function"){return}Vectr.getPoints(t);if(t.type.indexOf("mouse")!==-1){if(this.containsPoint(Vectr.instance.points[0].x,Vectr.instance.points[0].y)){this.onUp()}}else{var e=Vectr.instance.points.length;while(e--){if(this.containsPoint(Vectr.instance.points[e].x,Vectr.instance.points[e].y)){this.onUp();break}}}};Vectr.Button.prototype.containsPoint=function(t,e){return t<this.position.x+this.width/2+this.padding/2&&t>this.position.x-this.width/2-this.padding/2&&e<this.position.y+this.height/2&&e>this.position.y-this.height/2-this.padding};Vectr.Button.prototype.destroy=function(){Vectr.instance.element.removeEventListener("mouseup",this.onPointEnd,false);Vectr.instance.element.removeEventListener("touchend",this.onPointEnd,false)};Vectr.Button.prototype.update=function(t){return};Vectr.Emitter=function(t,e,i,s,n,o){var r,a;t=t||25;this.duration=e||1;this.fade=o||false;this.particles=new Vectr.Pool;this.speed=200;if(a=n.match(/^rgba\((\d+),\s?(\d+),\s?(\d+),\s?(\d?\.?\d*)\)$/)){this.color={red:parseInt(a[1],10),green:parseInt(a[2],10),blue:parseInt(a[3],10)}}while(t--){r=new Vectr.Shape(0,0,i,s);r.active=false;r.solid=true;this.particles.add(r)}};Vectr.Emitter.prototype.start=function(t,e){this.particles.activateAll();this.active=true;var i,s=this.particles.length;while(s--){this.particles.at(s).position.x=t;this.particles.at(s).position.y=e;i=Math.random()*2*Math.PI;this.particles.at(s).velocity.x=Math.cos(i);this.particles.at(s).velocity.y=Math.sin(i);this.particles.at(s).speed=Math.random()*this.speed;this.particles.at(s).color.red=this.color.red;this.particles.at(s).color.green=this.color.green;this.particles.at(s).color.blue=this.color.blue;this.particles.at(s).color.alpha=1}this.timer=0};Vectr.Emitter.prototype.draw=function(t){var e=this.particles.length;while(e--){this.particles.at(e).draw(t)}};Vectr.Emitter.prototype.update=function(t){this.timer+=t;var e=this.particles.length;if(e===0){this.active=false}while(e--){this.particles.at(e).update(t);if(this.fade){this.particles.at(e).color.alpha-=t/this.duration}if(this.timer>=this.duration){this.particles.deactivate(e)}}};Vectr.Label=function(t,e,i,s,n,o){var r;this.text=t;this.font={size:"20px",family:"monospaced"};if(typeof e==="string"){r=e.split(" ");if(r.length===2){this.font.size=r[0];this.font.family=r[1]}}this.color={red:255,green:255,blue:255,alpha:1};if(typeof i==="string"){r=i.split(",");if(r.length===4){this.color.red=parseInt(r[0].replace("rgba(",""),10);this.color.green=parseInt(r[1],10);this.color.blue=parseInt(r[2],10);this.color.alpha=parseFloat(r[3].replace(")",""),10)}}this.alignment="center";if(typeof o==="string"){this.alignment=o}this.scale=1;this.rotation=0;this.position={x:s,y:n};this.active=true;this.solid=true};Vectr.Label.prototype.draw=function(t){if(this.active===false){return}t.save();t.font=this.font.size+" "+this.font.family;t.textAlign=this.alignment;t.translate(this.position.x,this.position.y+parseInt(this.font.size,10)/3);if(this.scale!==1){t.scale(this.scale,this.scale)}if(this.rotation!==0&&this.rotation!==360){t.rotate(this.rotation)}if(this.solid===true){t.fillStyle="rgba("+this.color.red+", "+this.color.green+", "+this.color.blue+", "+this.color.alpha+")";t.fillText(this.text,0,0,Vectr.WIDTH)}else{t.strokeStyle="rgba("+this.color.red+", "+this.color.green+", "+this.color.blue+", "+this.color.alpha+")";t.strokeText(this.text,0,0,Vectr.WIDTH)}t.restore()};Vectr.Label.prototype.update=function(t){return};Vectr.Label.prototype.width=function(t){var e;t.save();t.font=this.font.size+" "+this.font.family;t.textAlign=this.alignment;e=t.measureText(this.text);t.restore();return e.width};Vectr.Scene=function(){this.children=[]};Vectr.Scene.prototype.draw=function(t){if(typeof this.clearColor==="string"){t.save();t.fillStyle=this.clearColor;t.fillRect(0,0,t.canvas.width,t.canvas.height);t.restore()}else{t.clearRect(0,0,t.canvas.width,t.canvas.height)}var e=this.children.length;while(e--){this.children[e].draw(t)}};Vectr.Scene.prototype.update=function(t){var e=this.children.length;while(e--){this.children[e].update(t)}};Vectr.Scene.prototype.add=function(t){this.children.push(t)};Vectr.Scene.prototype.remove=function(t){var e=this.children.indexOf(t);if(e!==-1){this.children.splice(e,1)}};Vectr.Scene.prototype.destroy=function(){var t=this.children.length;while(t--){if(typeof this.children[t].destroy==="function"){this.children[t].destroy()}}};Vectr.Pool=function(){this.length=0;this.children=[];this.inactive=[]};Vectr.Pool.prototype.activate=function(){if(this.inactive.length===0){return null}var t=this.inactive.pop();t.active=true;this.children.push(t);this.length+=1;return t};Vectr.Pool.prototype.activateAll=function(){var t;while(this.inactive.length){t=this.inactive.pop();t.active=true;this.children.push(t);this.length+=1}};Vectr.Pool.prototype.deactivate=function(t){if(this.children[t]===undefined){return}this.children[t].active=false;this.inactive.push(this.children[t]);var e,i;for(e=t,i=this.children.length-1;e<i;e+=1){this.children[e]=this.children[e+1]}this.children.length=i;this.length-=1;if(this.length===0){this.active=false}};Vectr.Pool.prototype.deactivateAll=function(){var t;while(this.children.length){t=this.children.pop();t.active=false;this.inactive.push(t);this.length-=1}};Vectr.Pool.prototype.at=function(t){return this.children[t]||null};Vectr.Pool.prototype.add=function(t){if(typeof t==="object"&&t.active===true){this.children.push(t);this.length+=1}else{this.inactive.push(t)}};Vectr.Pool.prototype.update=function(t){var e=this.children.length;while(e--){this.children[e].update(t);if(this.children[e].active===false){this.deactivate(e)}}};Vectr.Pool.prototype.draw=function(t){var e=this.children.length;while(e--){this.children[e].draw(t)}};Vectr.Shape=function(t,e,i,s,n,o){var r;this.shape=i||"square";this.size=s||10;this.lineWidth=1;this.lineJoin="round";this.scale=1;this.speed=1;this.rotation=0;this.position={x:t,y:e};this.velocity={x:0,y:0};this.active=true;this.solid=false;this.color={red:255,green:255,blue:255,alpha:1};if(typeof n==="string"&&(r=n.match(/^rgba\((\d+),\s?(\d+),\s?(\d+),\s?(\d?\.?\d*)\)$/))){this.color.red=parseInt(r[1],10);this.color.green=parseInt(r[2],10);this.color.blue=parseInt(r[3],10);this.color.alpha=parseFloat(r[4],10)}this.shadow={x:0,y:0,blur:0,color:{red:255,green:255,blue:255,alpha:1}};if(typeof o==="string"&&(r=o.match(/^(\d+(?:px)?)\s(\d+(?:px)?)\s(\d+(?:px)?)\srgba\((\d+),\s?(\d+),\s?(\d+),\s?(\d?\.?\d*)\)$/))){this.shadow.x=parseInt(r[1],10);this.shadow.y=parseInt(r[2],10);this.shadow.blur=parseInt(r[3],10);this.shadow.color.red=parseInt(r[4],10);this.shadow.color.green=parseInt(r[5],10);this.shadow.color.blue=parseInt(r[6],10);this.shadow.color.alpha=parseFloat(r[7],10)}};Vectr.Shape.prototype.draw=function(t){if(this.active===false){return}t.save();t.translate(this.position.x,this.position.y);if(this.scale!==1){t.scale(this.scale,this.scale)}if(this.rotation!==0&&this.rotation!==Math.PI*2){t.rotate(this.rotation)}if(this.shadow.x>0||this.shadow.y>0||this.shadow.blur>0){t.shadowOffsetX=this.shadow.x;t.shadowOffsetY=this.shadow.y;t.shadowBlur=this.shadow.blur;t.shadowColor="rgba("+this.shadow.color.red+", "+this.shadow.color.green+", "+this.shadow.color.blue+", "+this.shadow.color.alpha+")"}t.lineWidth=this.lineWidth;t.lineJoin=this.lineJoin;if(typeof this.customPath==="function"){this.customPath(t)}else{t.beginPath();switch(this.shape){case"triangle":t.moveTo(this.size/2*Math.cos(0),this.size/2*Math.sin(0));t.lineTo(this.size/2*Math.cos(120*Math.PI/180),this.size/2*Math.sin(120*Math.PI/180));t.lineTo(this.size/2*Math.cos(240*Math.PI/180),this.size/2*Math.sin(240*Math.PI/180));t.lineTo(this.size/2*Math.cos(0),this.size/2*Math.sin(0));break;case"circle":t.arc(0,0,this.size/2,360,false);break;case"square":t.moveTo(this.size/2,this.size/2);t.lineTo(this.size/2,-this.size/2);t.lineTo(-this.size/2,-this.size/2);t.lineTo(-this.size/2,this.size/2);t.lineTo(this.size/2,this.size/2);break}t.closePath();if(this.solid===true){t.fillStyle="rgba("+this.color.red+", "+this.color.green+", "+this.color.blue+", "+this.color.alpha+")";t.fill()}else{t.strokeStyle="rgba("+this.color.red+", "+this.color.green+", "+this.color.blue+", "+this.color.alpha+")";t.stroke()}}t.restore()};Vectr.Shape.prototype.update=function(t){if(this.active===false){return}this.position.x+=this.velocity.x*this.speed*t;this.position.y+=this.velocity.y*this.speed*t};Vectr.Shape.prototype.collidesWith=function(t){if(this.shape==="square"){return Math.abs(this.position.x-t.position.x)<this.size/2+t.size/2&&Math.abs(this.position.y-t.position.y)<this.size/2+t.size/2}return Math.sqrt(Math.pow(t.position.x-this.position.x,2)+Math.pow(t.position.y-this.position.y,2))<this.size/2+t.size/2};